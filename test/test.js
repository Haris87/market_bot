const { describe } = require("mocha");

const { expect } = require("chai");

const bot = require("../bot");

const orderbook = [
  [68562941618, 2011.7, 48.84658581],
  [68562942096, 2011.5, 49.41963471],
  [68562961578, 2011.5, 49.4635458],
  [68562961115, 2011.3, 1.01095865],
  [68562958472, 2011.2, 49.40718046],
  [68562961541, 2011.1, 9.93186],
  [68562933036, 2011.012024, 0.01557323],
  [68562933545, 2011.012024, 0.2163],
  [68562951574, 2011, 49.35027338],
  [68562962581, 2010.74146, 1.9862822],
  [68562941617, 2010.7, 49.89126143],
  [68562785201, 2010.5, 0.07367348],
  [68562942095, 2010.5, 49.97077264],
  [68562945201, 2010.5, 5],
  [68562961577, 2010.5, 49.96063617],
  [68562957526, 2010.465943992, 4.96541],
  [68562957949, 2010.465943992, 0.86782],
  [68562736205, 2010.407905506, 2],
  [68562889213, 2010.4, 0.1],
  [68562962239, 2010.4, 1.00158673],
  [68546689177, 2010.3, 2.892],
  [68562950661, 2010.288685444, 1.06094],
  [68562387599, 2010.2, 3.3],
  [68562803903, 2010.2, 0.07650889],
  [68562925251, 2010.2, 11.7902],
  [68562959303, 2012.2, -36.15],
  [68560810166, 2012.3, -4.0310326],
  [68560810198, 2012.3, -8.88],
  [68560810199, 2012.3, -8.88],
  [68560810200, 2012.3, -8.88],
  [68560810201, 2012.3, -8.88],
  [68560810202, 2012.3, -8.88],
  [68560810203, 2012.3, -8.88],
  [68560810204, 2012.3, -8.88],
  [68560810205, 2012.3, -8.88],
  [68560974737, 2012.3, -7.77],
  [68560974744, 2012.3, -7.77],
  [68560974746, 2012.3, -7.77],
  [68560974751, 2012.3, -7.77],
  [68560974754, 2012.3, -7.77],
  [68560974762, 2012.3, -7.77],
  [68562950842, 2012.3, -8.88],
  [68562956147, 2012.315426498, -8],
  [68562962569, 2012.43464656, -3.72463],
  [68562918169, 2012.455032, -0.21],
  [68562962630, 2012.561926002, -3.72505],
  [68560804223, 2012.6, -7.77],
  [68560810163, 2012.6, -6.654],
  [68560810164, 2012.6, -8.88],
  [68562962626, 2012.673086684, -4.9664],
];

describe("Simple test:", function () {
  it("wallet should be initialized", function () {
    const wallet = bot.getFunds();
    expect(wallet.ETH).to.equal(10);
    expect(wallet.USD).to.equal(2000);
  });

  it("should find best ask price", function () {
    const wallet = bot.getFunds();
    expect(bot.getBestAskPrice(orderbook)).to.equal(2012.2);
  });

  it("should find best bid price", function () {
    const wallet = bot.getFunds();
    expect(bot.getBestBidPrice(orderbook)).to.equal(2010.2);
  });

  it("should calculate price with less than 5% offset", function () {
    const wallet = bot.getFunds();
    expect(bot.calculateRandomPriceOffset(100))
      .to.be.lessThanOrEqual(105)
      .and.to.be.greaterThanOrEqual(95);
  });
});
